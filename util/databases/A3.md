## Database Design - Functional Dependencies


1. **Consider $R(A, B, C, D, E, F, G, H)$, with these FDs, $S = \{A → E\;\;, AD →
BE\;\;, AC → E\;\;, E → B\;\;, BG → F\;\;, BE → D\;\;, BDH → E\;\;, F → A\;\;, D → H\;\;, CD → A\}$**


## a) Find the (candidate) keys of this schema:

Since G only appears in the LHS, it must be part of the candidate keys. So, let's consider all subsets of attributes which contain G. But from those, C also only appears in the LHS, so it must also be part of the candidate keys:
2:

$(CG)^+ = CG$ (not a key)

3:

$(ACG)^+ = ABCDEFGH$ (it's a key!)

$(BCG)^+ = ABCDEFGH$ (it's a key!)

$(DCG)^+ = ABCDEFGH$ (it's a key!)

$(ECG)^+ = ABCDEFGH$ (it's a key!)

$(FCG)^+ = ABCDEFGH$ (it's a key!)

$(HCG)^+ = CGH$ (not a key)

Every other combination which is candidate to be a key would need to CG in it. But if the other attributes are all combinations of A, B, D, E, F, then they're just an extension of the keys with three attributes (therefore not minimal). The only case left would be subsets with H and CG. But to have H, C and G and a cardinality over 3, it means that H would have to be paired with an atribute from {A, B, D, E, F}, therefore it would not be minimal also.

So the candidate keys are:
$\{ACG, BCG, DCG, ECG, FCG\}$


 $S = \{A → E\;\;, AD →
BE\;\;, AC → E\;\;, E → B\;\;, BG → F\;\;, BE → D\;\;, BDH → E\;\;, F → A\;\;, D → H\;\;, CD → A\}$
## b) **Using 3NF**

I. **Keys = $\{ACG, BCG, DCG, ECG, FCG\}$**

II. **Calculate the Minimum Basis ($S$):**

    II.a: Expand all FD's RHS if possible:    
$S=\{A → E\;\;, AD →B\;\;,AD →E\;\;, AC → E\;\;, E → B\;\;, BG → F\;\;, BE → D\;\;, BDH → E\;\;, F → A\;\;,
D → H\;\;, CD → A\}$

    II.b: Replace all FD's which can be inferred with another one with less LHS attributes, if the LHS has cardinality greater than or equal 2:
    
a) $A \rightarrow E$: Skip

b) $AD \rightarrow B$: Replace $AD \rightarrow B$ with $A \rightarrow B$

Calculating Closures:
$(A)^+ = AEB$ , stop.

$S=\{A → E\;\;, A →B\;\;,AD →E\;\;, AC → E\;\;, E → B\;\;, BG → F\;\;, BE → D\;\;, BDH → E\;\;, F → A\;\;,
D → H\;\;, CD → A\}$

c) $AD \rightarrow E$: Replace $AD \rightarrow E$ with $A \rightarrow E$

Calculating Closures:
$(A)^+ = AEB$ , stop.

$S=\{A → E\;\;, A →B\;\;, AC → E\;\;, E → B\;\;, BG → F\;\;, BE → D\;\;, BDH → E\;\;, F → A\;\;,
D → H\;\;, CD → A\}$

d) $AC \rightarrow E$: Replace $AC \rightarrow E$ with $A \rightarrow E$

Calculating Closures:
$(A)^+ = AEB$ , stop.

$S=\{A → E\;\;, A →B\;\;, E → B\;\;, BG → F\;\;, BE → D\;\;, BDH → E\;\;, F → A\;\;,
D → H\;\;, CD → A\}$
 
e) $E \rightarrow B$: Skip

f) $BG \rightarrow F$: Stays
 
Calculating Closures:
$(B)^+ = B$, $(G)^+ = G$ , stop.
 
g) $BE \rightarrow D$: Replace $BE \rightarrow D$ with $E \rightarrow D$
 
Calculating Closures:
$(B)^+ = B$, $(E)^+ = EBD$ , stop.

$S=\{A → E\;\;, A →B\;\;, E → B\;\;, BG → F\;\;, E → D\;\;, BDH → E\;\;, F → A\;\;,
D → H\;\;, CD → A\}$

 
h) $BDH \rightarrow E$: Replace $BDH \rightarrow E$ with $BD \rightarrow E$
 
Calculating Closures:
$(B)^+ = B$, $(D)^+ = DH$ , $(H)^+ = H$, $(BD)^+ = BDHEB$ stop.


$S=\{A → E\;\;, A →B\;\;, E → B\;\;, BG → F\;\;, E → D\;\;, BD → E\;\;, F → A\;\;,
D → H\;\;, CD → A\}$
 
i) $F \rightarrow A$: Skip
 
j) $D \rightarrow H$: Skip
 
k) $CD \rightarrow A$: Stays
 
Calculating Closures:
$(C)^+ = C$, $(D)^+ = DH$, stop.


The current set of FDs is:

$S=\{A → E\;\;, A →B\;\;, E → B\;\;, BG → F\;\;, E → D\;\;, BD → E\;\;, F → A\;\;,
D → H\;\;, CD → A\}$

    II.c: For each functional dependency K in S, remove K from S if it can be inferred from S - {K}:

a) $A \rightarrow E$: Stays

$(A)^+_{S - \{(a)\}} = AB$

b) $A \rightarrow B$: Remove from S

$(A)^+_{S - \{(b)\}} = AEB$, stop.

c) $E \rightarrow B$: Stays

$(E)^+_{S - \{(b),(c)\}} = EDH$

d) $BG \rightarrow F$: Stays

$(BG)^+_{S - \{(b),(d)\}} = BG$

e) $E \rightarrow D$: Stays

$(E)^+_{S - \{(b),(e)\}} = EB$

f) $BD \rightarrow E$: Stays

$(BD)^+_{S - \{(b),(f)\}} = BDH$

g) $F \rightarrow A$: Stays

$(F)^+_{S - \{(b),(g)\}} = F$

h) $D \rightarrow H$: Stays

$(D)^+_{S - \{(b),(h)\}} = D$

i) $CD \rightarrow A$: Stays

$(CD)^+_{S - \{(b),(i)\}} = CDH$

The calculated Minimum Basis is:
$M =\{A → E\;\;, BG → F\;\;, E → BD\;\;, BD → E\;\;, F → A\;\;,
D → H\;\;, CD → A\}$

III. **For each FD $X\rightarrow Y$ in $M$ define a new relation with schema $X\cup Y$**

$R_1 = \{A,E\} $

$R_2 = \{B,G,F\} $

$R_3 = \{B,D,E\} $

$R_4 = \{F,A\} $

$R_5 = \{D,H\} $

$R_6 = \{C,D,A\} $

IV. **If no relation is a superkey/key for the attributes, add a new which is some key.**

In this case no relation is a superkey, so I'll add this one:

$R_7 = \{A,C,G\}$

**Answer:**
So our final decomposition is:

$R_1 = \{A,E\},\;\;F_1 = \{A → E\}$

$R_2 = \{B,G,F\},\;\;F_2 = \{BG → F\}$

$R_3 = \{B,D,E\} ,\;\;F_3 = \{E → BD,\;\;BD → E\}$

$R_4 = \{F,A\} ,\;\;F_4 = \{F → A\}$

$R_5 = \{D,H\} ,\;\;F_5 = \{D → H\}$

$R_6 = \{C,D,A\} ,\;\;F_6 = \{CD → A\}$

$R_7 = \{C,G,A\} ,\;\;F_7 = \{\}$


## c) **Find a BCNF decomposition of the schema**

A BCNF decomposition is a decomposition which doesn't violates the BCNF. I will use the relations I got from the 3NF in **b)**, since the question asks for a BCNF decomposition of the schema, not to follow the BCNF decomposition algorithm. I'll check if every relation is in BCNF, if not, apply the algorithm to that specific relation.

- $R_1 = \{A,E\},\;\;F_1 = \{A → E\}$
$(A)+ = AE$, A is superkey
 Violates BCNF? No
 
- $R_2 = \{B,G,F\},\;\;F_2 = \{BG → F\}$
$(BG)+ = BGF$, BG is superkey
 Violates BCNF? No
 
- $R_3 = \{B,D,E\} ,\;\;F_3 = \{E → BD,\;\;BD → E\}$
$(E)+ = EBD$, E is a superkey
$(BD)+ = EBD$, BD is a superkey
 Violates BCNF? No

- $R_4 = \{F,A\} ,\;\;F_4 = \{F → A\}$
$(F)+ = FA$, F is a superkey
 Violates BCNF? No

- $R_5 = \{D,H\} ,\;\;F_5 = \{D → H\}$
$(D)+ = DH$, D is a superkey
 Violates BCNF? No

- $R_6 = \{C,D,A\} ,\;\;F_6 = \{CD → A\}$
$(CD)+ = ACD$, CD is a superkey
 Violates BCNF? No

- $R_7 = \{C,G,A\} ,\;\;F_7 = \{\}$
 Violates BCNF? No

Since in this specific decomposition every relation follows the BCNF, it means this is a valid BCNF decomposition. Also, this is dependency preserving, since all FD's from the minimum basis are preserved (the 'lost' ones can be inferred from those). Here is the final BCNF decomposition of the schema:

$R_1 = \{A,E\},\;\;F_1 = \{A → E\}$

$R_2 = \{B,G,F\},\;\;F_2 = \{BG → F\}$

$R_3 = \{B,D,E\} ,\;\;F_3 = \{E → BD,\;\;BD → E\}$

$R_4 = \{F,A\} ,\;\;F_4 = \{F → A\}$

$R_5 = \{D,H\} ,\;\;F_5 = \{D → H\}$

$R_6 = \{C,D,A\} ,\;\;F_6 = \{CD → A\}$

$R_7 = \{C,G,A\} ,\;\;F_7 = \{\}$


